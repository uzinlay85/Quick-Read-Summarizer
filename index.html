<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Read Summarizer</title>
    <!-- Google AI SDK -->
    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>
    <style>
        :root {
            --bg-color: #f8f9fa; --text-color: #212529; --primary-color: #007bff;
            --card-bg: #ffffff; --border-color: #dee2e6; --shadow: 0 4px 6px rgba(0,0,0,0.05 );
            --input-bg: #f1f3f5; --placeholder-color: #adb5bd; --button-color: #495057;
            --button-hover: #343a40; --loader-color: #007bff;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0; background-color: var(--bg-color); color: var(--text-color);
            line-height: 1.6;
        }
        .container { max-width: 1100px; margin: 20px auto; padding: 20px; }
        .page { display: none; }
        .page.active { display: block; }
        /* Setup Page Styles */
        .setup-container { max-width: 600px; margin: 50px auto; background: var(--card-bg); padding: 40px; border-radius: 12px; box-shadow: var(--shadow); }
        .setup-container h1 { text-align: center; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--input-bg); }
        .btn { display: block; width: 100%; padding: 12px; border: none; border-radius: 8px; background-color: var(--button-color); color: white; font-size: 16px; cursor: pointer; transition: background-color 0.2s; }
        .btn:hover { background-color: var(--button-hover); }
        .api-link { font-size: 12px; text-align: right; margin-top: 5px; }
        .api-link a { color: var(--primary-color); text-decoration: none; }
        /* Main App Styles */
        .app-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .input-column, .output-column { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: var(--shadow); }
        .input-column h2, .output-column h2 { margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        textarea { width: 100%; height: 200px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--input-bg); resize: vertical; }
        .image-upload-box { border: 2px dashed var(--border-color); border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: var(--input-bg); margin-bottom: 20px; }
        .image-upload-box:hover { border-color: var(--primary-color); }
        .image-preview-container { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .img-preview { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
        .summarize-options { margin-top: 20px; }
        #summary-result { min-height: 300px; background: var(--input-bg); border-radius: 8px; padding: 15px; white-space: pre-wrap; word-wrap: break-word; }
        .loader { display: none; margin: 50px auto; width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--loader-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Responsive */
        @media (max-width: 900px) { .app-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="setup-page" class="page active">
        <div class="container">
            <div class="setup-container">
                <h1>Quick Read Summarizer</h1>
                <p style="text-align:center;">Enter your Gemini API key to get started.</p>
                <div class="form-group">
                    <label for="api-key">Gemini API Key</label>
                    <input type="password" id="api-key" placeholder="Enter your API Key">
                    <p class="api-link"><a href="https://aistudio.google.com/app/apikey" target="_blank">Get an API Key here</a></p>
                </div>
                <div class="form-group">
                    <label for="model-select-setup">Gemini Model</label>
                    <select id="model-select-setup">
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro (Recommended for Quality )</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash (Recommended for Speed)</option>
                    </select>
                </div>
                <button id="continue-btn" class="btn">Continue</button>
            </div>
        </div>
    </div>

    <div id="main-page" class="page">
        <div class="container">
            <h1 style="text-align:center;">Quick Read Summarizer</h1>
            <div class="app-grid">
                <div class="input-column">
                    <h2>Your Content</h2>
                    <p>Upload images or type your text below.</p>
                    
                    <div id="image-upload-box" class="image-upload-box">
                        <span>⬆️ Upload Images (Max 5)</span>
                        <input type="file" id="image-upload-input" multiple accept="image/*" style="display:none;">
                    </div>
                    <div id="image-preview-container"></div>
                    
                    <textarea id="text-input" placeholder="Type or paste your text here..."></textarea>
                    
                    <div class="summarize-options">
                        <label for="format-select">Summarize Format</label>
                        <select id="format-select" class="form-group">
                            <option value="Bullet Points">Bullet Points</option>
                            <option value="a single Paragraph">Paragraph</option>
                        </select>
                    </div>
                    
                    <button id="get-summary-btn" class="btn">Get Summary</button>
                </div>
                <div class="output-column">
                    <h2>Summary Result</h2>
                    <div id="loader" class="loader"></div>
                    <div id="summary-result">Your summary will appear here...</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ELEMENTS ---
            const setupPage = document.getElementById('setup-page');
            const mainPage = document.getElementById('main-page');
            const apiKeyInput = document.getElementById('api-key');
            const modelSelectSetup = document.getElementById('model-select-setup');
            const continueBtn = document.getElementById('continue-btn');
            
            const imageUploadBox = document.getElementById('image-upload-box');
            const imageUploadInput = document.getElementById('image-upload-input');
            const imagePreviewContainer = document.getElementById('image-preview-container');
            const textInput = document.getElementById('text-input');
            const formatSelect = document.getElementById('format-select');
            const getSummaryBtn = document.getElementById('get-summary-btn');
            const loader = document.getElementById('loader');
            const summaryResultDiv = document.getElementById('summary-result');

            // --- STATE ---
            let uploadedImages = [];
            let genAI;
            let model;

            // --- INITIALIZATION ---
            function initializeApp() {
                const savedApiKey = localStorage.getItem('geminiApiKey');
                const savedModel = localStorage.getItem('geminiModel');
                if (savedApiKey && savedModel) {
                    try {
                        genAI = new window.GoogleGenerativeAI(savedApiKey);
                        model = genAI.getGenerativeModel({ model: savedModel });
                        setupPage.classList.remove('active');
                        mainPage.classList.add('active');
                    } catch (error) {
                        alert("Failed to initialize with saved API key. Please enter it again.");
                        localStorage.clear();
                    }
                }
            }

            continueBtn.addEventListener('click', () => {
                const apiKey = apiKeyInput.value.trim();
                const selectedModel = modelSelectSetup.value;
                if (!apiKey) {
                    alert('Please enter your Gemini API Key.');
                    return;
                }
                try {
                    genAI = new window.GoogleGenerativeAI(apiKey);
                    model = genAI.getGenerativeModel({ model: selectedModel });
                    localStorage.setItem('geminiApiKey', apiKey);
                    localStorage.setItem('geminiModel', selectedModel);
                    setupPage.classList.remove('active');
                    mainPage.classList.add('active');
                } catch (error) {
                    alert("Invalid API Key or model. Please check and try again.");
                    console.error("Initialization Error:", error);
                }
            });

            // --- IMAGE HANDLING ---
            imageUploadBox.addEventListener('click', () => imageUploadInput.click());
            imageUploadInput.addEventListener('change', (event) => {
                const files = event.target.files;
                if (files.length + uploadedImages.length > 5) {
                    alert("You can upload a maximum of 5 images.");
                    return;
                }
                for (const file of files) {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            uploadedImages.push({
                                inlineData: {
                                    data: e.target.result.split(',')[1],
                                    mimeType: file.type,
                                }
                            });
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'img-preview';
                            imagePreviewContainer.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    }
                }
            });

            // --- SUMMARIZATION LOGIC ---
            getSummaryBtn.addEventListener('click', async () => {
                const text = textInput.value.trim();
                const format = formatSelect.value;

                if (!text && uploadedImages.length === 0) {
                    alert("Please provide text or upload images to summarize.");
                    return;
                }

                loader.style.display = 'block';
                summaryResultDiv.style.display = 'none';
                getSummaryBtn.disabled = true;

                try {
                    const promptParts = [];
                    let promptText = "Summarize the following content";
                    
                    if (text) {
                        promptText += ` from the text: "${text}"`;
                    }
                    if (uploadedImages.length > 0) {
                        promptText += " and from the content of the attached image(s).";
                        promptParts.push(...uploadedImages);
                    }
                    
                    promptText += ` Please provide the summary in the form of ${format}. The summary should be in the same language as the source text.`;
                    promptParts.unshift(promptText);

                    const result = await model.generateContent(promptParts);
                    const response = await result.response;
                    const summary = response.text();
                    
                    summaryResultDiv.textContent = summary;

                } catch (error) {
                    console.error("Summarization Error:", error);
                    summaryResultDiv.textContent = "An error occurred. Please check the console for details. Your API key might be invalid or has expired.";
                } finally {
                    loader.style.display = 'none';
                    summaryResultDiv.style.display = 'block';
                    getSummaryBtn.disabled = false;
                }
            });

            // --- START THE APP ---
            initializeApp();
        });
    </script>
</body>
</html>
